function setUpFilters(a){if(filtersContainer&&filtersContainer.length>1){var b=doT.template($("#filters-tpl").text());$.get("/api/tags/filters",function(c){c.isShowCategories=isShowCategories;var d=$(b(c));$(filtersContainer).html(d),$(".filter-slick-container").slick(),a&&resetGridContainer()})}}function onFilterSelected(a,b){var c=$("#"+a);$(".filter-group[data-index="+b+"]").removeClass("active"),c.addClass("active");var d=$(".filter-group"),e=0,f={};$.each(d,function(a,b){var c=parseInt($(b).data("index"));c>=e&&(e=c)}),$.each(d,function(a,b){b=$(b);var c=parseInt(b.data("index")),d=b.hasClass("active");d&&0===c&&(f.category=b.data("d")),d&&c===e&&(f.sort=JSON.stringify(b.data("d"))),d&&c!==e&&0!==c&&(f.tags||(f.tags=[]),$.trim(b.data("d")).length>0&&f.tags.push(b.data("d")))}),pageAllFilters="/"+encodeURIComponent(JSON.stringify(f)),resetGridContainer()}function resetGridContainer(){currentIndex=-1,currentTotal=pageSize,commoditiesArea&&(commoditiesArea.masonry("destroy"),commoditiesArea=null),$(pageContainer).html(""),onNextPage()}function onNextPage(){if(!(0>currentTotal)){currentIndex>-1&&showLoading(),Waypoint.destroyAll(),currentIndex++;var a=doT.template($("#commodity-tpl").text());$.get(pageApiUrl+currentIndex+pageAllFilters,function(b){b.list=b.list?b.list:b.items;var c=$(a(b)),d=$(pageContainer);d.append(c),commoditiesArea?d.imagesLoaded(function(){commoditiesArea.masonry("appended",c),pageLazyloadImage(b),onPageLoaded(b,currentIndex)}):commoditiesArea=d.imagesLoaded(function(){masonryArea=d.masonry({itemSelector:".grid-item",isAnimated:!0}),pageLazyloadImage(b)})})}}function pageLazyloadImage(a){$("img.lazy").lazyload({container:$("#container"),effect:"fadeIn",load:function(){masonryArea.masonry({isAnimated:!1}),$("img.lazy").removeClass("lazy")}}),closeLoading(),bindNextPage(parseInt(a.total)),onPageLoaded(a,currentIndex)}function bindNextPage(a){currentTotal=a,(currentIndex+1)*pageSize>currentTotal&&(currentTotal=-1);var b={offset:"bottom-in-view",context:$("#container")};$("#bottom-area").waypoint(function(){onNextPage()},b)}var commoditiesArea,masonryArea,pageContainer="undefined"!=typeof pageContainer?pageContainer:".grid-items-container",pageApiUrl="undefined"!=typeof pageApiUrl?pageApiUrl:"/api/commodities/choice/pages/",pageSize="undefined"!=typeof pageSize?pageSize:20,currentIndex=-1,currentTotal=pageSize,pageAllFilters="",filtersContainer="undefined"!=typeof filtersContainer?filtersContainer:"",isShowCategories="undefined"!=typeof isShowCategories?isShowCategories:!0,onPageLoaded="undefined"!=typeof onPageLoaded?onPageLoaded:function(a,b){};$(document).ready(function(){setUpFilters()});