function commoditiesPage(){if(startRun()){if(0>currentTotal)return $(".not-more-tips-area").fadeIn(),void stopRun();currentIndex>-1&&showLoading(),Waypoint.destroyAll(),currentIndex++;var a=10,b=$("#index-type-input").val(),c="/api/commodities/"+b+"/pages/"+currentIndex;$.get(c,function(b){var c=doT.template($("#commodity-tpl").text()),d=c(b),e=$("#commodities-area"),f=$("#container");e.append(d),e.masonry({itemSelector:".grid-item",isAnimated:!0}),$("img.lazy").lazyload({container:f,effect:"fadeIn"}),currentTotal=parseInt(b.total),(currentIndex+1)*a>currentTotal&&(currentTotal=-1),closeLoading(),pageCurrentTop=storeWithExpiration.get(pageCurrentStore),pageCurrentTop>0&&f.animate({scrollTop:pageCurrentTop},500);var g={offset:"bottom-in-view",context:f};$("#bottom-area").waypoint(function(){commoditiesPage()},g),stopRun()})}}function clearSearchInput(){var a=$(".header #search-keyword-input");a.val(""),a.removeClass("active"),$(".search-submit-btn").hide(),$(".clear-search-input-btn").hide()}function search(a,b,c){var d="/search/$TYPE/$VALUE";a&&a.length>0&&(d=d.replace("$TYPE","keyword").replace("$VALUE",a)),b&&b.length>0&&(d=d.replace("$TYPE","category").replace("$VALUE",b)),c&&c.length>0&&(d=d.replace("$TYPE","tag").replace("$VALUE",c));var e=$("#search-form");e.attr("action",d),localStorage.setItem(searchReturnUrl,"/"),e.submit()}function sntextHandle(a){return $.sntext(a,{debug:!1,onAt:function(a,b){return'<a href="/users/search/'+$.removeHTMLTags(b)+'" class="in-at-link">'+a+"</a>"},onTag:function(a,b){return"<a href='javascript:activityToSearch(\""+$.removeHTMLTags(b)+'", "/commodities")\' class="in-comment-link">'+a+"</a>"}})}function iZanIt(a){if(startRun()){var b="animated bounceIn",c=$("#like"+a);c.css("color","#e84034"),c.addClass(b),$(c).one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){var d="/api/commodities/"+a+"/zans";$.post(d,function(d){var e=$("#zans-"+a+"-count"),f=parseInt(e.html());e.html(++f),$("#zans-"+a+"-btn").attr("href",'javascript:iCancelZanIt("'+a+'");'),c.removeClass(b),stopRun()})})}}function iCancelZanIt(a){if(startRun()){var b="animated bounceIn",c=$("#like"+a);c.css("color","rgba(232, 64, 52, 0.5)"),c.addClass(b),$(c).one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){var d="/api/commodities/"+a+"/zans/cancel";$.post(d,function(d){var e=$("#zans-"+a+"-count"),f=parseInt(e.html());e.html(f>0?--f:0),$("#zans-"+a+"-btn").attr("href",'javascript:iZanIt("'+a+'");'),c.removeClass(b),stopRun()})})}}function iFollowIt(a,b){if(startRun()){var c="/api/users/"+a+"/follow/"+b;$.post(c,function(a){var c=$(".follower-"+b),d=c.parent(),e="animated bounceIn";c.addClass("active").html("已关注"),d.addClass(e),$(d).one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){d.removeClass(e),d.html(""),follows.push(b),stopRun()})})}}function iUnFollowIt(a,b){if(startRun()){var c="/api/users/"+a+"/unfollow/"+b;$.post(c,function(c){var d=$(".follower-"+b);d.html('<span class="fa fa-plus"></span> 关注'),d.removeClass("active");var e=d.parent(),f=e.attr("href");e.attr("href",f.replace("iUnFollowIt","iFollowIt")),follows.splice($.inArray(a,follows),1),stopRun()})}}function iFavoriteIt(a,b){if(startRun()){var c="animated bounceIn",d=$("#favorite"+b).find("> i");d.css("color","#f4c51e"),d.addClass(c),$(d).one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){var e="/api/users/"+a+"/favorites";$.get(e,function(e){d.parent().attr("href",'javascript:iUnFavoriteIt("'+a+'", "'+b+'");'),d.removeClass(c),stopRun()})})}}function iUnFavoriteIt(a,b){if(startRun()){var c="animated bounceIn",d=$("#favorite"+b).find("> i");d.css("color","#555353"),d.addClass(c),$(d).one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){d.parent().attr("href",'javascript:iFavoriteIt("'+a+'", "'+b+'");'),d.removeClass(c),stopRun()})}}function showCommodityWithComment(a){localStorage.setItem("with_comment",null),window.location.href="/commodities/"+a}$(document).ready(function(){activeToolbarItem("btn-discover");var a=$("#container");commoditiesPage(),a.scroll(function(){var b=parseInt(a.scrollTop());50>b&&(b=0),Math.abs(b-pageCurrentTop)>50&&(pageCurrentTop=b,storeWithExpiration.set(pageCurrentStore,pageCurrentTop,1800))});var b=$(".header #search-keyword-input");b.focus(function(){b.addClass("active"),$(".search-submit-btn").show()}),b.keyup(function(a){$.trim(b.val()).length>0?(b.addClass("active"),$(".search-submit-btn").show(),$(".clear-search-input-btn").show()):(b.removeClass("active"),$(".search-submit-btn").hide(),$(".clear-search-input-btn").hide()),"13"===a.keyCode&&search(b.val(),null,null)}),pageCurrentTop=storeWithExpiration.get(pageCurrentStore),pageCurrentTop>0&&a.animate({scrollTop:pageCurrentTop},200),$("#clear-touchmove").click(function(a){var b=$("#shoucang-alert-message-panel");this===a.target&&b.foundation("reveal","close")})});var currentIndex=-1,currentTotal=10,follows;