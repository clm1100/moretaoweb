function loadComments(a){var b=url(-1,window.location.href),c=(doT.template($("#activity-comments-tpl").text()),"/api/activities/"+b+"/comments/"+a);$.get(c,function(a){setupComments(a.items),$(".more-btn").hide()})}function showCommentEditor(a,b,c){var d="animated bounceInUp",e=$("#comment-editor"),f=$("#comment-textarea"),g=$("#comment-parent-input"),h=$("#comment-cid-input");c?(f.val("[回复: "+c+"] "),g.val(a),h.val(b)):f.val(""),e.css("height",document.body.clientHeight+"px"),e.show(),e.addClass(d),e.one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){e.removeClass(d)})}function hideCommentEditor(a){var b="animated bounceOutDown",c=$("#comment-editor");c.addClass(b),c.one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){c.hide(),c.removeClass(b),a&&a()})}function iCommentIt(){var a=$("#send-comment-btn"),b=a.attr("href");a.attr("href","###");var c=$("#activity-id").val(),d=$.trim($("textarea#comment-textarea").val()),e=$("#comment-parent-input"),f=$("#comment-cid-input"),g="/api/activities/"+c+"/comments",h=/^\[回复:.*\]$/g;return!d||""===d||d.match(h)?void a.attr("href",b):void $.post(g,{comment:d,parent:e.val(),main:f.val()},function(c){hideCommentEditor(function(){loadComments(5),a.attr("href",b)})})}function iZanIt(){if(startRun()){var a=$("#activity-id").val(),b="animated bounceIn",c=$("#btn-zan-link"),d=c.find("> i");d.addClass("active"),d.addClass(b);var e="/api/activities/"+a+"/zans";d.one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){$.post(e,function(a){var e=$(".zan-count");e.text(a.result),c.attr("href",'javascript:iCancelZanIt("'+a.id+'");'),d.removeClass(b),stopRun()})})}}function iCancelZanIt(){if(startRun()){var a=$("#activity-id").val(),b="/api/activities/"+a+"/zans/cancel",c="animated bounceIn",d=$("#btn-zan-link"),e=d.find("> i");e.removeClass("active"),e.addClass(c),e.one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){$.post(b,function(a){var b=$(".zan-count");b.text(a.result),d.attr("href","javascript:iZanIt();"),e.removeClass(c),stopRun()})})}}$(document).ready(function(){$("#pull-to-refresh").hide(),showReturnArrow(),loadComments(5)});